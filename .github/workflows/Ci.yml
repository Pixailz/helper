name: CI

run-name: Update submodule CI/CD

on:
  workflow_dispatch:
    inputs:
      commit_msg:
        required: true
        description: "the commit message to spread"
      git_email:
        required: true
        description: "the email used to commit"

jobs:
  info:
    runs-on: ubuntu-latest
    steps:
      - name: "üí¨ github"
        run: |+
          echo "Who launched: ${{github.actor}}"
          echo "On branch:    ${{github.ref_name}}"
          echo "Commit sha:   ${{github.sha}}"

      - name: "üí¨ Bin utils"
        run: |+
          make --version && echo
          ar --version && echo
          gcc --verbose && echo
          python3 --version

  prepare-ft_libft:
    runs-on: ubuntu-latest
    steps:
      - name: ‚≠ê Retrieve ft_libft repo
        run: |+
          git clone https://github.com/Pixailz/ft_libft
          rm -rf ft_libft/rsc/helper
          git clone https://github.com/Pixailz/helper ft_libft/rsc/helper

      - name: ‚≠ê Git commit
        run: |+
          git config --global user.name ${{ github.actor }}
          git config --global user.email ${{ github.actor }}
          cd ft_libft
          git add rsc/helper
          git commit -m "${{ github.event.inputs.commit_msg }}"

      - name: ‚≠ê Create tarball
        run: tar cvf ft_libft.tar ft_libft

      - name: ‚≠ê Upload ft_libft.tar artifact
        uses: actions/upload-artifact@v3
        with:
          name: ft_libft
          path: ft_libft.tar
          retention-days: 1

  test-ft_libft:
    needs: prepare-ft_libft
    runs-on: ubuntu-latest
    steps:
      - name: ‚≠ê Download ft_libft.tar artifact
        uses: actions/download-artifact@v3
        with:
          name: ft_libft

      - name: ‚≠ê Unpack ft_libft.tar
        run: tar xvf ft_libft.tar

      - name: üîß test ft_libft
        run: make -C ft_libft

      - name: ‚úÖ ft_libft push
        run: cd ft_libft && git push

