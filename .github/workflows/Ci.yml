name: CI

run-name: Update submodule CI/CD

on:
  workflow_dispatch:
    inputs:
      commit_msg:
        required: true
        description: "the commit message to spread"

jobs:
  info:
    runs-on: ubuntu-latest
    steps:
      - name: "üí¨ github"
        run: |+
          echo "Who launched: ${{github.actor}}"
          echo "On branch:    ${{github.ref_name}}"
          echo "Commit sha:   ${{github.sha}}"

      - name: "üí¨ Bin utils"
        run: |+
          make --version && echo
          ar --version && echo
          gcc --verbose && echo
          python3 --version

  test:
    runs-on: ubuntu-latest
    steps:
      - name: ‚≠ê Retrieve all repo
        run: |+
          mkdir test && cd test
          git clone https://github.com/Pixailz/ft_libft
          rm -rf ft_libft/rsc/helper
          git clone https://github.com/Pixailz/helper ft_libft/rsc/helper
          git clone https://github.com/Pixailz/ft_ping
          rm -rf ft_ping/{lib/ft_libft,rsc/helper}
          cp -r {,ft_ping/lib/}ft_libft
          cp -r ft_ping/{lib/ft_libft/rsc/helper,rsc/helper}
          git clone https://github.com/Pixailz/SupaBlank
          rm -rf SupaBlank/{lib/ft_libft,rsc/helper}
          cp -r {,SupaBlank/lib/}ft_libft
          cp -r SupaBlank/{lib/ft_libft/rsc/helper,rsc/helper}

      - name: ‚≠ê test ft_libft
        run: make -C test/ft_libft

      - name: ‚≠ê test ft_libft
        run: make -C test/ft_ping

      - name: ‚≠ê test ft_libft
        run: make -C test/SupaBlank

      - name: ‚úÖ commit
        run: |+
          cd test/ft_libft
          git add rsc/helper
          git commit -m "${{ github.event.inputs.commit_msg }}"
          cd ../ft_ping
          rm -rf lib/ft_libft
          cp -r ../ft_libft lib/ft_libft
          cp -r {lib/ft_libft/,}rsc/helper
          git add lib/ft_libft rsc/helper
          git commit -m "${{ github.event.inputs.commit_msg }}"
          cd ../SupaBlank
          rm -rf lib/ft_libft
          cp -r ../ft_libft lib/ft_libft
          cp -r {lib/ft_libft/,}rsc/helper
          git add lib/ft_libft rsc/helper
          git commit -m "${{ github.event.inputs.commit_msg }}"
          git push
          cd ../ft_ping
          git push
          cd ../ft_libft
          git push
